<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../../shared/includes/meta') %>
    <title><%= app.name %> Roadmap</title>
    <%- include('../../shared/includes/styles') %>
  </head>

  <body id="pageBody" class="bg-background">
    <% if (isOwner) { %>
    <div class="fixed right-8 bottom-8">
      <a
        href="/apps"
        class="flex h-14 w-14 items-center justify-center rounded-full bg-white shadow-md">
        <i class="fas fa-th text-gray-dark text-xl"></i>
      </a>
    </div>
    <% } %>

    <!-- Header Section -->
    <div
      id="appHeader"
      class="flex justify-center p-6 shadow-sm sm:px-28 sm:py-14">
      <div class="flex w-full max-w-xl flex-col justify-center space-y-3">
        <div class="flex items-center space-x-4">
          <div
            class="flex h-10 w-10 items-center justify-center rounded-full bg-white">
            <% if (app.design && app.design.logo) { %>
            <img
              src="<%= app.design.logo %>"
              alt="<%= app.name %>"
              class="h-full w-full rounded-full object-cover" />
            <% } else { %>
            <span class="text-lg font-medium text-black"
              ><%= app.name.charAt(0) %></span
            >
            <% } %>
          </div>
          <h1 class="text-lg font-medium text-white sm:text-xl">
            <%= app.name %> Roadmap
          </h1>
        </div>

        <p class="max-w-2xl text-sm text-gray-100 sm:text-base">
          Track our development progress and upcoming features
        </p>
      </div>
    </div>

    <main class="mx-auto flex justify-center p-6 sm:px-28 sm:py-8">
      <div class="w-full max-w-xl">
        <!-- Back Button -->
        <div class="mb-6 flex justify-start">
          <a
            href="/apps/<%= app._id %>"
            class="flex items-center text-gray-600 transition-colors hover:text-gray-900">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to App
          </a>
        </div>
        <!-- Add Item Button for Owners -->
        <% if (isOwner) { %>
        <div class="mb-6 flex justify-start">
          <a
            href="/apps/<%= app._id %>/roadmap/add"
            class="cursor-pointer rounded-xl px-6 py-3 text-base text-white transition-all hover:opacity-90 active:scale-95"
            id="addRoadmapBtn">
            <i class="fas fa-plus mr-2"></i>
            Add Item
          </a>
        </div>
        <% } %>

        <!-- Roadmap Board -->
        <div class="mb-6 space-y-4">
          <!-- Planned Column -->
          <div class="w-full rounded-xl bg-white p-4 shadow-sm">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold text-gray-800">Planned</h2>
              <span
                class="rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-600">
                <%= roadmapItems.planned.length %>
              </span>
            </div>
            <div class="min-h-[75px] space-y-3">
              <% roadmapItems.planned.forEach(item => { %> <%-
              include('../../shared/partials/roadmap-item', { item, isOwner })
              %> <% }) %>
            </div>
          </div>

          <!-- In Progress Column -->
          <div class="w-full rounded-xl bg-white p-4 shadow-sm">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold text-gray-800">In Progress</h2>
              <span
                class="rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-600">
                <%= roadmapItems['in-progress'].length %>
              </span>
            </div>
            <div class="min-h-[100px] space-y-3">
              <% roadmapItems['in-progress'].forEach(item => { %> <%-
              include('../../shared/partials/roadmap-item', { item, isOwner })
              %> <% }) %>
            </div>
          </div>

          <!-- Completed Column -->
          <div class="w-full rounded-xl bg-white p-4 shadow-sm">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold text-gray-800">Completed</h2>
              <span
                class="rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-600">
                <%= roadmapItems.completed.length %>
              </span>
            </div>
            <div class="min-h-[100px] space-y-3">
              <% roadmapItems.completed.forEach(item => { %> <%-
              include('../../shared/partials/roadmap-item', { item, isOwner })
              %> <% }) %>
            </div>
          </div>

          <!-- Cancelled Column -->
          <div class="w-full rounded-xl bg-white p-4 shadow-sm">
            <div class="mb-4 flex items-center justify-between">
              <h2 class="text-lg font-semibold text-gray-800">Cancelled</h2>
              <span
                class="rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-600">
                <%= roadmapItems.cancelled.length %>
              </span>
            </div>
            <div class="min-h-[100px] space-y-3">
              <% roadmapItems.cancelled.forEach(item => { %> <%-
              include('../../shared/partials/roadmap-item', { item, isOwner })
              %> <% }) %>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <% if (roadmapItems.planned.length === 0 &&
        roadmapItems['in-progress'].length === 0 &&
        roadmapItems.completed.length === 0 && roadmapItems.cancelled.length ===
        0) { %>
        <div class="rounded-xl bg-white p-8 text-center shadow-sm">
          <h3 class="mb-2 text-lg font-medium text-gray-900">
            No roadmap items yet
          </h3>
          <p class="mb-8 text-gray-500">
            <% if (isOwner) { %> Get started by adding your first roadmap item
            to share your development plans. <% } else { %> The development team
            hasn't shared any roadmap items yet. <% } %>
          </p>
          <% if (isOwner) { %>
          <a
            href="/apps/<%= app._id %>/roadmap/add"
            class="cursor-pointer rounded-xl px-6 py-3 text-sm text-white transition-all hover:opacity-90 active:scale-95"
            id="addFirstItemBtn">
            <i class="fas fa-plus mr-2"></i>
            Add First Item
          </a>
          <% } %>
        </div>
        <% } %>
      </div>
    </main>

    <%- include('../../shared/includes/scripts') %>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Apply custom app design
        const backgroundColor =
          '<%= app.design?.backgroundColor || "#F3F4F6" %>';
        const headerColor = '<%= app.design?.headerColor || "#374151" %>';
        const headerTextColor =
          '<%= app.design?.headerTextColor || "#FFFFFF" %>';
        const buttonColor = '<%= app.design?.buttonColor || "#111827" %>';
        const backButtonColor =
          '<%= app.design?.backButtonColor || "#6B7280" %>';
        const cardBgColor =
          '<%= app.design?.suggestionCardBgColor || "#FFFFFF" %>';

        // Set header background
        const headerElement = document.getElementById('appHeader');
        if (headerElement) {
          headerElement.style.backgroundColor = headerColor;

          // Apply header text colors
          const headerTitle = headerElement.querySelector('h1');
          const headerDescription = headerElement.querySelector('p');
          if (headerTitle) headerTitle.style.color = headerTextColor;
          if (headerDescription)
            headerDescription.style.color = headerTextColor;
        }

        // Set body background
        const bodyElement = document.getElementById('pageBody');
        if (bodyElement) {
          bodyElement.style.backgroundColor = backgroundColor;
        }

        // Set main background
        const mainElement = document.querySelector('main');
        if (mainElement) {
          mainElement.style.backgroundColor = backgroundColor;
        }

        // Set button backgrounds
        const addButton = document.getElementById('addRoadmapBtn');
        const addFirstButton = document.getElementById('addFirstItemBtn');

        if (addButton) {
          addButton.style.backgroundColor = buttonColor;
        }
        if (addFirstButton) {
          addFirstButton.style.backgroundColor = buttonColor;
        }

        // Style back button
        const backButton = document.querySelector('a[href*="/apps/"]');
        if (backButton) {
          backButton.style.color = backButtonColor;
          // Override hover state to maintain custom color
          backButton.style.setProperty('color', backButtonColor, 'important');
          backButton.addEventListener('mouseenter', () => {
            backButton.style.setProperty('color', backButtonColor, 'important');
          });
          backButton.addEventListener('mouseleave', () => {
            backButton.style.setProperty('color', backButtonColor, 'important');
          });
        }

        // Style roadmap columns with custom card background
        const roadmapColumns = document.querySelectorAll(
          '.rounded-xl.bg-white'
        );
        roadmapColumns.forEach(column => {
          column.style.backgroundColor = cardBgColor;
        });
      });
    </script>
  </body>
</html>
